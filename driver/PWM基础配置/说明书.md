# PWM配置及核心知识说明

## 一、关键配置步骤

### 1. GPIO初始化
- **使能GPIOA时钟**  
  `rcu_periph_clock_enable(RCU_GPIOA);`  
  *作用：开启GPIOA外设的时钟，确保引脚可配置*

- **配置PA8为复用推挽输出**  
  `gpio_init(GPIOA, GPIO_MODE_AF_PP, GPIO_OSPEED_50MHZ, GPIO_PIN_8);`  
  *作用：将PA8引脚映射到定时器外设（复用功能），推挽输出保证高低电平驱动能力*


### 2. 定时器时基配置
- **核心参数**  
  - 预分频器：`PRESCALER = 120 - 1`  
  - 周期值（自动重装载值）：`PERIOD = 500 - 1`  

- **PWM频率计算公式**  

PWM 频率 = 定时器时钟 / (预分频器 + 1) / (周期值 + 1)

plaintext
*示例*：  
当定时器时钟为120MHz时：  
`120MHz / 120 / 500 = 2kHz`（即生成2kHz的PWM信号）


### 3. 输出比较配置
- **核心参数**  
- 脉冲值（比较值）：`PULSE = 250 - 1`  
- PWM模式：`TIMER_OC_MODE_PWM0`  
- 输出极性：高电平有效（`TIMER_OC_POLARITY_HIGH`）

- **占空比计算公式**  

占空比 = (脉冲值 + 1) / (周期值 + 1) × 100%

plaintext
*示例*：  
`(250 / 500) × 100% = 50%`（即输出50%占空比的PWM）


### 4. 高级配置
- **主输出使能**：`timer_primary_output_config(TIMERx);`  
*作用：允许定时器输出PWM信号到外部引脚*

- **定时器使能**：`timer_enable(TIMERx);`  
*作用：启动定时器计数，开始生成PWM信号*


## 二、PWM核心知识

### 1. PWM原理
- **定义**：通过调节脉冲宽度（占空比）模拟模拟信号（如调节LED亮度、电机转速）
- **关键参数**：  
- 频率（周期）：信号重复的快慢（周期 = 1/频率）  
- 占空比：脉冲宽度占整个周期的比例（决定"平均电压"）


### 2. 定时器工作模式（PWM生成逻辑）
```plaintext
计数器变化：0 → 周期值 → 0（循环计数）
        ↑
输出波形：  |----高电平----|----低电平----|
             （脉冲值范围）   （剩余周期）

PWM 模式 0：当计数器（CNT）< 比较值（CCRx）时，输出有效电平
PWM 模式 1：当计数器（CNT）< 比较值（CCRx）时，输出无效电平
3. 关键寄存器
寄存器名称	作用	对应参数
TIMERx_CAR（自动重装载）	存储周期值，决定 PWM 周期	周期值（PERIOD）
TIMERx_CHxCV（比较寄存器）	存储脉冲值，决定高电平宽度	脉冲值（PULSE）
TIMERx_CHxCTL（控制寄存器）	配置 PWM 模式（0/1）和输出极性	模式 / 极性配置
